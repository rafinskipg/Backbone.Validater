!function(a,b){"function"==typeof define&&define.amd?define(["jQuery","_","Backbone"],b):a.amdWeb=b(a.jQuery,a._,a.Backbone)}(this,function(a,b,c){var d=c.View.extend({validations:{},hasContent:function(a){if(b.isBoolean(a))return!0;if(b.isArray(a)&&a.length>0)return!0;if(!b.isArray(a)&&b.keys(a).length>0){for(var c=b.keys(a),d=0;d<c.length;d++)if(this.hasContent(a[c[d]]))return!0;return!1}return b.isFinite(a)||!b.isEmpty(a)?!0:!1},checkRequiredFields:function(){var a=this.model.toJSON(),b=[];for(var c in this.model.requiredFields){var d=this.model.requiredFields[c];this.hasContent(a[d])||b.push({field:d,validation:"required"})}return b.length>0?b:null},customValidations:function(){var a=this.getConditionsFulfilled(),b=[];if(a.length>0){var c=this;a.forEach(function(a){var d=a.fields.map(function(a){return a.filters?c.getFilteredValuesFromField(a):c.model.get(a.name)}),e=c[a.validation].apply(c,d);(0==e||"string"==typeof e)&&a.fields.forEach(function(c){b.push({field:a.alias||c.name,validation:"string"==typeof e?e:a.validation})})})}return b},getConditionsFulfilled:function(){var a=this.extractConditionsFromBindings(),c=this;return a=b.compact(a.map(function(a){var b=!0;return a.fields.forEach(function(a){c.fieldFulfillsCondition(a)||(b=!1)}),b?a:void 0}))},fieldFulfillsCondition:function(a){var b=!0;if(a.exists)if(this.model.get(a.name)&&this.hasContent(this.model.get(a.name))){if(a.filters&&a.filters.length>0){var c=this.getFilteredValuesFromField(a);this.hasContent(c)||(b=!1)}}else b=!1;else if(this.model.get(a.name)&&this.hasContent(this.model.get(a.name))&&!a.filters)b=!1;else if(a.filters&&a.filters.length>0){var c=this.getFilteredValuesFromField(a);this.hasContent(c)&&(b=!1)}return b},getFilteredValuesFromField:function(a){return b.isArray(this.model.get(a.name))?this.filterArrayValues(a):this.filterObjectValues(a)},filterArrayValues:function(a){var c=this;return b.filter(this.model.get(a.name),function(b){var d=!0;return a.filters.forEach(function(a){var e=c.getFieldValue(a,b);a.exists?(!e||a.value&&e!=a.value||!a.value&&!c.hasContent(e))&&(d=!1):e&&(d=!1)}),d})},filterObjectValues:function(a){var b=this.model.get(a.name),c=!0,d=this;return a.filters.forEach(function(a){var e=d.getFieldValue(a,b);a.exists?(!e||a.value&&e!=a.value||!a.value&&!d.hasContent(e))&&(c=!1):e&&(c=!1)}),c?b:null},getFieldValue:function(a,b){var c=function(a,b){return b&&b[a.name]?a.nested&&b[a.name]?c(a.nested,b[a.name]):b[a.name]:null};return c(a,b)},extractConditionsFromBindings:function(){var a=[];for(var c in this.validations){var d={},e=c,f=this.getAliasFromConditionString(c);f.length>0&&(e=c.replace(f+":",""),d.alias=f),d.fields=this.getFieldsFromFieldsString(e);var g=this.validations[c];"string"==typeof g?(d.validation=g,a.push(d)):g.forEach(function(c){var e=b.clone(d);e.validation=c,a.push(e)})}return a},getAliasFromConditionString:function(a){var b=a.indexOf(":");return-1!=b?a.substr(0,b):""},getFieldsFromFieldsString:function(a){var b=this;return a.match(/[^&]+(?=\{)\{\S+\}|[^&]+/g).map(function(a){var c={name:a};b.appendFiltersInfo(c);var d=-1==c.name.indexOf("!");if(c.name=c.name.replace("!",""),c.exists=d,-1!=c.name.indexOf(".")){var e=c.name.split("."),f=function(a,b){var d=a.splice(1);if(b.name=a[0],0==d.length){var e=b.name.indexOf("=");if(-1!=e){var g=b.name.substr(0,e);c.value=b.name.substr(e+1,b.name.length).replace(/\"/g,""),b.name=g}return b}return b.nested=f(d,{}),b};f(e,c)}else{var g=c.name.indexOf("=");if(-1!=g){var h=c.name.substr(0,g);c.value=c.name.substr(g+1,c.name.length).replace(/\"/g,""),c.name=h}}return c})},removeFiltersStringFromField:function(a){var b=/{([^}]*)}/,c=b.exec(a)[0];return a.replace(c,"")},appendFiltersInfo:function(a){var b=this.getFiltersFromField(a.name);b&&(a.filters=b,a.name=this.removeFiltersStringFromField(a.name))},getFiltersFromField:function(a){var b=/{([^}]*)}/;if(b.test(a)){var c=b.exec(a)[1],d=this.getFieldsFromFieldsString(c);return d}return null},validate:function(){var a=b.compact(Array.prototype.concat(this.checkRequiredFields(),this.customValidations()));return a.length>0?a:null}});return d.VERSION="<% VERSION %>",c.validator=d,d});