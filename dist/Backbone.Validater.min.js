!function(a,b){"function"==typeof define&&define.amd?define(["jQuery","_","Backbone"],b):a.amdWeb=b(a.jQuery,a._,a.Backbone)}(this,function(a,b,c){var d=c.View.extend({validations:{},hasContent:function(a){if(b.isBoolean(a))return!0;if(b.isArray(a)&&a.length>0)return!0;if(!b.isArray(a)&&b.keys(a).length>0){for(var c=b.keys(a),d=0;d<c.length;d++)if(this.hasContent(a[c[d]]))return!0;return!1}return b.isFinite(a)||!b.isEmpty(a)?!0:!1},checkRequiredFields:function(){var a=this.model.toJSON(),b=[];for(var c in this.model.requiredFields){var d=this.model.requiredFields[c];this.hasContent(a[d])||b.push({field:d,validation:"required"})}return b.length>0?b:null},customValidations:function(){var a=this.getConditionsFulfilled(),b=[];if(a.length>0){var c=this;a.forEach(function(a){var d=a.fields.map(function(a){return a.filters?c.getFilteredValuesFromField(a):c.model.get(a.name)});c[a.validation].apply(c,d)||a.fields.forEach(function(c){b.push({field:c.name,validation:a.alias||a.validation})})})}return b},getConditionsFulfilled:function(){var a=this.extractConditionsFromBindings(),c=this;return a=b.compact(a.map(function(a){var b=!0;return a.fields.forEach(function(a){c.fieldFulfillsCondition(a)||(b=!1)}),b?a:void 0}))},fieldFulfillsCondition:function(a){var b=!0;if(a.exists)if(this.model.get(a.name)&&this.hasContent(this.model.get(a.name))){if(a.filters&&a.filters.length>0){var c=this.getFilteredValuesFromField(a);this.hasContent(c)||(b=!1)}}else b=!1;else this.model.get(a.name)&&this.hasContent(this.model.get(a.name))&&(b=!1);return b},getFilteredValuesFromField:function(a){return b.isArray(this.model.get(a.name))?this.filterArrayValues(a):this.filterObjectValues(a)},filterArrayValues:function(a){var c=this;return b.filter(this.model.get(a.name),function(b){var d=!0;return a.filters.forEach(function(a){var e=b[a.field];(!e||a.value&&e!=a.value||!a.value&&!c.hasContent(e))&&(d=!1)}),d})},filterObjectValues:function(a){var b=this.model.get(a.name),c=!0,d=this;return a.filters.forEach(function(a){var e=b[a.field];(!e||a.value&&e!=a.value||!a.value&&!d.hasContent(e))&&(c=!1)}),c?b:null},extractConditionsFromBindings:function(){var a=[],c=this;for(var d in this.validations){var e={},f=d,g=this.getAliasFromConditionString(d);g.length>0&&(f=d.replace(g+":",""),e.alias=g);var h=this.getFieldsFromFieldsString(f);e.fields=h,e.fields=e.fields.map(function(a){var b=c.getFiltersFromField(a.name);return b&&(a.filters=b,a.name=c.removeFiltersStringFromField(a.name)),a});var i=this.validations[d];"string"==typeof i?(e.validation=i,a.push(e)):i.forEach(function(c){var d=b.clone(e);d.validation=c,a.push(d)})}return a},getAliasFromConditionString:function(a){var b=a.indexOf(":");return-1!=b?a.substr(0,b):""},getFieldsFromFieldsString:function(a){return a.match(/[^&]+(?=\{)\{\S+\}|[^&]+/g).map(function(a){var b=-1==a.indexOf("!");return a=a.replace("!",""),{name:a,exists:b}})},removeFiltersStringFromField:function(a){var b=/{([^}]*)}/,c=b.exec(a)[0];return a.replace(c,"")},getFiltersFromField:function(a){var b=/{([^}]*)}/;if(b.test(a)){var c=b.exec(a)[1],d=this.getFieldsFromFieldsString(c);return d=d.map(function(a){var b={field:a.name},c=a.name.indexOf("=");return-1!=c&&(b.field=a.name.substr(0,c),b.value=a.name.substr(c+1,a.name.length).replace(/\"/g,"")),b})}return null},validate:function(){var a=b.compact(Array.prototype.concat(this.checkRequiredFields(),this.customValidations()));return a.length>0?a:null}});return d.VERSION="<% VERSION %>",c.validator=d,d});